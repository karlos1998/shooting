version: '3.2'
services:
  app:
    image: "shooting-backend:${TAG}"
    restart: unless-stopped
    environment:
      - VIRTUAL_HOST=shooting.letscode.it
      - VIRTUAL_PORT=8080
      - SPRING_DATA_MONGODB_URI=mongodb://secret:root@shooting_mongo:27017/mydatabase
    networks:
      - nginx-proxy
      - shooting-network
    depends_on:
      - mongodb

  mongodb:
    image: mongo:4.4.6
    container_name: shooting_mongo
    restart: unless-stopped
    environment:
      - 'MONGO_INITDB_DATABASE=mydatabase'
      - 'MONGO_INITDB_ROOT_PASSWORD=secret'
      - 'MONGO_INITDB_ROOT_USERNAME=root'
    networks:
      - shooting-network

networks:
  nginx-proxy:
    external:
      name: nginx-proxy
  shooting-network:
